# bdim

A macOS CLI tool that bridges **spec-kit → Beads → GitHub Issues**.

After you run the spec-kit workflow (`/speckit.constitution` → `/speckit.specify` → `/speckit.plan` → `/speckit.tasks`), `bdim` picks up the generated `tasks.md`, creates real [Beads](https://github.com/steveyegge/beads) in the local `bd` database, and pushes them to GitHub Issues — with full idempotency, project scoping, and a clear source-of-truth model.

---

## How it works

```
spec-kit workflow (run in your AI agent):
  /speckit.constitution                  ← establish project principles
  /speckit.specify                       ← define feature requirements
  /speckit.plan                          ← create implementation plan
  /speckit.tasks                         ← generate tasks.md
        │
        ▼
specs/<NNN-feature>/tasks.md            ← generated by spec-kit
        │
        ▼
bdim create                             ← Phase 1  (auto-discovers tasks.md)
        │
        ▼
  bd (Bead database)                    ← Source of truth after this point
        │
        ▼
bdim sync --repo owner/repo             ← Phase 2
        │
        ▼
  GitHub Issues                         ← Read-only projection
```

**Source of truth rules:**
- spec-kit `tasks.md` is canonical _until_ Beads are created in `bd`
- After Beads exist in `bd`, **Beads are the source of truth**
- GitHub Issues are downstream projections — edits there do not flow back into Beads (unless `--force` is used)

---

## Requirements

```bash
brew install jq gh
gh auth login

# Install the Beads CLI
npm i -g @beads/bd
# or: brew install beads
```

| Dependency | Required for | Install |
|---|---|---|
| `bash` | everything | ships with macOS |
| `jq` | everything | `brew install jq` |
| `gh` | `convert` / `sync` | `brew install gh` |
| `bd` | `create`, `status`, `sync`, `latest`, `update` | `npm i -g @beads/bd` |
| `specify` | `init` | `npm i -g @spec-kit/cli` |

You also need [spec-kit](https://github.com/github/spec-kit) installed so that `bdim init` can scaffold the project and `/speckit.tasks` can generate `tasks.md`.

---

## Installation

```bash
git clone https://github.com/Papanii/GitBeadsIssueManagement.git
cd GitBeadsIssueManagement

# Install globally (no sudo needed)
mkdir -p ~/.local/bin
ln -sf "$PWD/bdim" ~/.local/bin/bdim

# Add to PATH if not already (add to ~/.zshrc or ~/.bashrc)
export PATH="$HOME/.local/bin:$PATH"
source ~/.zshrc
```

After this, `bdim` works from any directory.

---

## Quick start

```bash
# 1. Initialise spec-kit + bd in your project (first time only)
cd your-project/
bdim init

# 2. Run the spec-kit workflow in your AI agent (Claude chat / IDE)
/speckit.constitution        # establish project principles
/speckit.specify             # define feature requirements & user stories
/speckit.clarify             # (optional) resolve ambiguities in the spec
/speckit.plan                # create technical implementation plan
/speckit.tasks               # generate tasks.md from the plan

# 3. Import tasks into your local bd database
bdim create

# 4. Push to GitHub Issues
bdim sync --repo owner/my-project
```

That's it. Re-run steps 2–4 whenever you add or update features — unchanged Beads are skipped automatically.

---

## Commands

### `init` — Initialise a project

```bash
bdim init [--dry-run]
```

Initialises both **spec-kit** and the **bd database** in the current directory:

1. **spec-kit** — runs `specify init --here --ai claude --force` to scaffold the spec-kit project (creates `constitution.md` and `specs/`). Skipped if either already exists.
2. **bd database** — runs `bd init` to create the local Beads database. Skipped if already initialised.
3. **.gitignore** — adds `.beads/dolt/` and `.beads/*.db` entries so binary database files are never committed.

Idempotent — safe to run multiple times; each step is skipped if already completed.

| Option | Description |
|---|---|
| `--dry-run` | Preview without writing anything |
| `--verbose, -v` | Print debug output |

---

### `create` — Import spec-kit tasks into Beads

```bash
bdim create [options]
```

Auto-discovers all `tasks.md` files under `specs/*/tasks.md` in the current directory and creates or updates Beads in the local `bd` database. No file path argument needed.

Each task line becomes one Bead tagged with the `speckit` label. `[US\d+]` markers automatically create an **epic** Bead for each unique user story — child tasks are linked underneath it. Project ID is derived automatically from the spec folder name (`001-my-feature` → `my-feature`). Fully idempotent — re-running only touches tasks that have changed.

| Option | Default | Description |
|---|---|---|
| `--project, -p ID` | folder name | Override the project namespace (only valid when one `tasks.md` is found) |
| `--dry-run` | off | Preview what would be created/updated without calling `bd` |
| `--verbose, -v` | off | Print debug output |

**Example:**

```bash
# Preview first
bdim create --dry-run

# Import for real
bdim create

# Override project name
bdim create --project my-project
```

---

### `convert` — Push Beads to GitHub Issues

```bash
bdim convert --repo owner/name [options]
```

Reads Beads from the local `bd` database and pushes them to GitHub Issues. By default only Beads tagged `speckit` are included; pass `--all-beads` to sync every Bead regardless of label. Creates new issues for unsynced Beads and updates existing ones when content has changed. Manual edits to GitHub issues are preserved unless `--force` is used.

Epic Beads are synced last so child issues already have issue numbers, producing a native GitHub progress-bar task list in the epic issue body.

| Option | Default | Description |
|---|---|---|
| `--repo, -r REPO` | _(required)_ | GitHub repo, e.g. `acme/my-project` |
| `--force` | off | Override manual GitHub edits; always push Bead content |
| `--dry-run` | off | Preview without touching GitHub |
| `--all-beads` | off | Sync all Beads regardless of label (default: `speckit`-labelled only) |
| `--verbose, -v` | off | Print debug output |

---

### `sync` — Idempotent sync of changed Beads to GitHub

```bash
bdim sync --repo owner/name [options]
```

Alias for `convert`. Only pushes Beads whose content has changed since the last sync. Same options as `convert`.

---

### `status` — Show sync state of all Beads

```bash
bdim status [--all-beads]
```

Prints a table of every Bead in the `bd` database with its status, GitHub issue number, and whether it needs syncing. By default only Beads tagged `speckit` are shown; pass `--all-beads` to include every Bead regardless of label. Read-only — makes no changes.

**Example output:**

```
Bead ID              Title                                            Status         GH Issue     Synced?
──────────────────────────────────────────────────────────────────────────────────────────────────────────────
bd-a1b2              Create project structure                         closed         #12          up to date
bd-c3d4              Implement tasks.md parser                        in_progress    #13          needs update
bd-e5f6              Add auto-discovery of specs directory            open           #-           not synced

Total: 3 | Synced: 1 | Needs sync: 2
```

---

### `latest` — Pull shared beads from git

```bash
bdim latest [--dry-run]
```

Pulls the latest changes from the remote git repository and imports `.beads/issues.jsonl` into the local `bd` database. Replaces the manual two-step:

```bash
git pull
bd import -i .beads/issues.jsonl
```

Stops immediately if `git pull` fails (e.g. merge conflict) so `bd import` is never run on a broken state. Warns gracefully if `.beads/issues.jsonl` is not present after the pull.

| Option | Description |
|---|---|
| `--dry-run` | Preview without running git or bd |
| `--verbose, -v` | Print debug output |

---

### `update` — Share your beads with the team

```bash
bdim update [--message MSG]
```

Exports the `bd` database to `.beads/issues.jsonl`, stages the file, commits it, and pushes. Replaces the manual three-step:

```bash
git add .beads/issues.jsonl
git commit -m "Update beads"
git push
```

Re-exports first to guarantee the file reflects the current state of `bd` (not just the last auto-export). Skips the commit entirely if `.beads/issues.jsonl` has not changed. If `git push` fails (e.g. remote is ahead), the error message suggests running `bdim latest` first.

| Option | Default | Description |
|---|---|---|
| `--message, -m MSG` | `"Update beads"` | Custom git commit message |
| `--dry-run` | off | Preview without running git or bd |
| `--verbose, -v` | off | Print debug output |

**Example:**

```bash
bdim update
bdim update --message "Sync beads after US1 implementation"
bdim update --dry-run   # preview what would happen
```

---

## tasks.md format

spec-kit generates `tasks.md` under `specs/<NNN-feature-name>/tasks.md` at the repo root. Each task is a markdown checklist line:

```
- [ ] T001 Create project structure per implementation plan
- [ ] T005 [P] Implement auth middleware in src/middleware/auth.py
- [x] T012 [P] [US1] Create User model in src/models/user.py
- [ ] T014 [US1] Implement UserService in src/services/user_service.py
```

| Component | Required | Description |
|---|---|---|
| `- [ ]` or `- [x]` | yes | Checkbox — unchecked = open, checked = closed |
| `T001` | yes | Task ID — sequential, e.g. T001, T002, T003 |
| `[P]` | no | Parallel marker — task can run concurrently with others |
| `[US1]` | no | User story / epic group — maps priority (US1=high, US2=medium, US3+=low) |
| description | yes | Full task description including file path |

All other lines (phase headers, blank lines, comments, dependency sections) are silently skipped. Phase headers (`## Phase N: User Story N - Title`) are parsed to name the epic Bead automatically.

See [`examples/tasks.md`](examples/tasks.md) for a complete sample.

---

## Epics

Each unique `[US\d+]` marker in `tasks.md` creates one **epic** Bead of type `epic` in `bd`. Tasks tagged with that marker become children linked to the epic via `parent_external_ref` in their metadata.

On GitHub, the epic becomes a parent issue with a `## Children` task list:

```markdown
## Epic: User Story 1: Import spec-kit tasks

| Field | Value |
| --- | --- |
| Type | epic |
| User Story | `US1` |
| Priority | P1 |

## Children

- [ ] #7 T006: Implement tasks.md parser in bdim
- [ ] #8 T007: Map task fields to Bead fields
```

GitHub auto-renders the task list with a **native progress bar** that ticks as child issues are closed. Run `bdim sync` a second time after the first to populate real `#N` links (children need one sync to receive issue numbers).

---

## Field mapping

### tasks.md → Bead (`bd`)

| tasks.md | Bead field | Notes |
|---|---|---|
| description | `title` | Text after task ID and markers |
| task ID | `external_ref` | `"speckit-<project>-T001"` — stable cross-system identity |
| `[ ]` | `status: open` | |
| `[x]` | `status: closed` | |
| `[P]` | `labels: parallel` | Added to label list |
| `[US1]` | `labels: US1` + `priority: 1` | US2→P2, US3+→P3, no US→P2 |
| `[US1]` (first task) | creates epic Bead | `issue_type: epic`, `external_ref: speckit-<project>-US1` |
| — | `issue_type: task` | Always `task` for non-epic Beads |
| — | `labels: speckit` | Always present — used for filtering |
| task ID | `metadata.task_id` | |
| user story | `metadata.user_story` | |
| parallel flag | `metadata.parallel` | |
| — | `metadata.parent_external_ref` | Set on child tasks; links to parent epic |

### Bead → GitHub Issue

| Bead field | GitHub field | Notes |
|---|---|---|
| `title` | title | |
| `metadata.task_id` + `metadata.user_story` | body | Rendered as a metadata table |
| `metadata.is_epic == true` | body | Rendered as epic table + children task list |
| `labels[]` | labels | Labels are created in the repo if missing |
| `status == "closed"` | state = `closed` | Open otherwise |
| — | body (HTML comment) | Hidden idempotency anchor for dedup |

---

## Full workflow example

```bash
# --- Phase 1: Setup & generate tasks ---

cd your-project/
bdim init                                # first time only — sets up spec-kit + bd + .gitignore

# In your Claude chat / IDE, run the spec-kit workflow:
#   /speckit.constitution        — establish project principles
#   /speckit.specify             — define feature requirements & user stories
#   /speckit.clarify             — (optional) resolve ambiguities
#   /speckit.plan                — create technical implementation plan
#   /speckit.tasks               — generate tasks.md from the plan
# This creates: specs/001-my-feature/tasks.md  (at your repo root)

# --- Phase 2: Import into Beads ---

# Preview what will be created
bdim create --dry-run

# Import tasks as Beads (also creates epic Beads for [US\d+] groups)
bdim create

# Check the current sync state
bdim status

# --- Phase 3: Push to GitHub Issues ---

# Preview GitHub changes
bdim convert --repo acme/my-project --dry-run

# Push to GitHub (epics get parent issues with child task lists)
bdim convert --repo acme/my-project

# Run sync a second time to populate #N links in epic task lists
bdim sync --repo acme/my-project

# --- Ongoing: re-run after tasks.md changes ---

bdim create                          # picks up new/changed tasks
bdim sync --repo acme/my-project     # syncs changes to GitHub
```

---

## Team workflow (multi-machine)

`bdim` automatically exports `.beads/issues.jsonl` after every write command. This JSONL file is one bead per line — plain text, git-diffable, and auto-mergeable.

**Never commit `.beads/dolt/`** — it's a binary Dolt database. Only commit `issues.jsonl`.

```
.beads/
  dolt/           ← binary — in .gitignore
  *.db            ← binary — in .gitignore
  issues.jsonl    ← text, one bead per line — commit this
```

### Daily workflow

```bash
# 1. Pull the latest shared beads
bdim latest                          # git pull + bd import

# 2. Run the spec-kit workflow if there are spec changes, then:
bdim create                          # auto-exports issues.jsonl
bdim sync --repo acme/my-project     # auto-exports issues.jsonl

# 3. Share the updated bead database
bdim update                          # bd export + git add + commit + push
bdim update --message "Sync after US2 epic"   # with a custom commit message
```

`bdim latest` and `bdim update` replace the manual git/bd commands so the workflow is four lines instead of seven.

---

## How idempotency works

Every Bead stores two hashes in its `metadata`:

- **`content_hash`** — SHA-256 of the Bead's key fields. Recomputed each run. If the task hasn't changed, the Bead is not touched.
- **`github_issue_synced_hash`** — the `content_hash` at the time of the last successful GitHub sync. If these differ, the issue is updated on the next `sync`.

Every GitHub issue body also contains a hidden HTML comment:

```html
<!-- bdim:external_id:speckit-my-project-T001 -->
```

On `sync`, this anchor is used to find the matching issue so it is updated rather than recreated — even if the `bd` database is wiped and rebuilt from scratch.

---

## Exit codes

| Code | Meaning |
|---|---|
| `0` | Success |
| `1` | Runtime error (e.g. a bead failed to sync) |
| `2` | Usage / argument error |

---

## Project structure

```
bdim                       ← the CLI script (single file, v3.2.0)
tests/
  bdim_tests               ← test suite (no bd/gh required)
examples/
  tasks.md                 ← sample spec-kit tasks.md
```
