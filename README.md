# bdim

A macOS CLI tool that bridges **spec-kit → Beads → GitHub Issues**.

After you run `/speckit.tasks` in your spec-kit project, `bdim` picks up the generated `tasks.md`, creates real [Beads](https://github.com/steveyegge/beads) in the local `bd` database, and pushes them to GitHub Issues — with full idempotency, project scoping, and a clear source-of-truth model.

---

## How it works

```
/speckit.tasks  (run inside your spec-kit project)
        │
        ▼
specs/<NNN-feature>/tasks.md            ← generated by spec-kit
        │
        ▼
bdim speckit-to-beads               ← Phase 1  (auto-discovers tasks.md)
        │
        ▼
  bd (Bead database)                    ← Source of truth after this point
        │
        ▼
bdim sync --repo owner/repo         ← Phase 2
        │
        ▼
  GitHub Issues                         ← Read-only projection
```

**Source of truth rules:**
- spec-kit `tasks.md` is canonical _until_ Beads are created in `bd`
- After Beads exist in `bd`, **Beads are the source of truth**
- GitHub Issues are downstream projections — edits there do not flow back into Beads (unless `--force` is used)

---

## Requirements

```bash
brew install jq gh
gh auth login

# Install the Beads CLI
npm i -g @beads/bd
# or: brew install beads
```

| Dependency | Required for | Install |
|---|---|---|
| `bash` | everything | ships with macOS |
| `jq` | everything | `brew install jq` |
| `gh` | `beads-to-gh` / `sync` | `brew install gh` |
| `bd` | `speckit-to-beads`, `status`, `sync` | `npm i -g @beads/bd` |

You also need [spec-kit](https://github.com/github/spec-kit) installed in your project so that `/speckit.tasks` can generate `tasks.md`.

### First-time project setup

In your project repo, add this to `.gitignore` to exclude the binary Dolt database while keeping the git-trackable JSONL:

```
# bd (Beads CLI) — binary database, never commit
.beads/dolt/
.beads/*.db
```

Then initialise the bead database in your project root:

```bash
bd init
```

---

## Installation

```bash
git clone https://github.com/Papanii/GitBeadsIssueManagement.git
cd GitBeadsIssueManagement

# Install globally (no sudo needed)
mkdir -p ~/.local/bin
ln -sf "$PWD/bdim" ~/.local/bin/bdim

# Add to PATH if not already (add to ~/.zshrc or ~/.bashrc)
export PATH="$HOME/.local/bin:$PATH"
source ~/.zshrc
```

After this, `bdim` works from any directory.

---

## Quick start

```bash
# 1. Generate tasks.md from your spec in the Claude chat / IDE
#    (run this as a slash command in your spec-kit project)
/speckit.tasks

# 2. Import tasks into your local bd database
cd your-project/
bdim speckit-to-beads

# 3. Push to GitHub Issues
bdim sync --repo owner/my-project
```

That's it. Re-run `bdim sync` whenever you update tasks — unchanged Beads are skipped automatically.

---

## Commands

### `speckit-to-beads` — Import spec-kit tasks into Beads

```bash
bdim speckit-to-beads [options]
```

Auto-discovers all `tasks.md` files under `specs/*/tasks.md` in the current directory and creates or updates Beads in the local `bd` database. No file path argument needed.

Each task line becomes one Bead tagged with the `speckit` label. Project ID is derived automatically from the spec folder name (`001-my-feature` → `my-feature`). Fully idempotent — re-running only touches tasks that have changed.

| Option | Default | Description |
|---|---|---|
| `--project, -p ID` | folder name | Override the project namespace (only valid when one `tasks.md` is found) |
| `--dry-run` | off | Preview what would be created/updated without calling `bd` |
| `--verbose, -v` | off | Print debug output |

**Example:**

```bash
# Preview first
bdim speckit-to-beads --dry-run

# Import for real
bdim speckit-to-beads

# Override project name
bdim speckit-to-beads --project my-project
```

---

### `beads-to-gh` — Push Beads to GitHub Issues

```bash
bdim beads-to-gh --repo owner/name [options]
```

Reads Beads from the local `bd` database and pushes them to GitHub Issues. By default only Beads tagged `speckit` are included; pass `--all-beads` to sync every Bead regardless of label. Creates new issues for unsynced Beads and updates existing ones when content has changed. Manual edits to GitHub issues are preserved unless `--force` is used.

| Option | Default | Description |
|---|---|---|
| `--repo, -r REPO` | _(required)_ | GitHub repo, e.g. `acme/my-project` |
| `--force` | off | Override manual GitHub edits; always push Bead content |
| `--dry-run` | off | Preview without touching GitHub |
| `--all-beads` | off | Sync all Beads regardless of label (default: `speckit`-labelled only) |
| `--verbose, -v` | off | Print debug output |

---

### `sync` — Idempotent sync of changed Beads to GitHub

```bash
bdim sync --repo owner/name [options]
```

Alias for `beads-to-gh`. Only pushes Beads whose content has changed since the last sync. Same options as `beads-to-gh`.

---

### `status` — Show sync state of all Beads

```bash
bdim status [--all-beads]
```

Prints a table of every Bead in the `bd` database with its status, GitHub issue number, and whether it needs syncing. By default only Beads tagged `speckit` are shown; pass `--all-beads` to include every Bead regardless of label. Read-only — makes no changes.

**Example output:**

```
Bead ID              Title                                            Status         GH Issue     Synced?
──────────────────────────────────────────────────────────────────────────────────────────────────────────────
bd-a1b2              Create project structure                         closed         #12          up to date
bd-c3d4              Implement tasks.md parser                        in_progress    #13          needs update
bd-e5f6              Add auto-discovery of specs directory            open           #-           not synced

Total: 3 | Synced: 1 | Needs sync: 2
```

---

## tasks.md format

spec-kit generates `tasks.md` under `specs/<NNN-feature-name>/tasks.md` at the repo root. Each task is a markdown checklist line:

```
- [ ] T001 Create project structure per implementation plan
- [ ] T005 [P] Implement auth middleware in src/middleware/auth.py
- [x] T012 [P] [US1] Create User model in src/models/user.py
- [ ] T014 [US1] Implement UserService in src/services/user_service.py
```

| Component | Required | Description |
|---|---|---|
| `- [ ]` or `- [x]` | yes | Checkbox — unchecked = open, checked = closed |
| `T001` | yes | Task ID — sequential, e.g. T001, T002, T003 |
| `[P]` | no | Parallel marker — task can run concurrently with others |
| `[US1]` | no | User story label — maps priority (US1=high, US2=medium, US3+=low) |
| description | yes | Full task description including file path |

All other lines (phase headers, blank lines, comments, dependency sections) are silently skipped.

See [`examples/tasks.md`](examples/tasks.md) for a complete sample.

---

## Field mapping

### tasks.md → Bead (`bd`)

| tasks.md | Bead field | Notes |
|---|---|---|
| description | `title` | Text after task ID and markers |
| task ID | `external_ref` | `"speckit-<project>-T001"` — stable cross-system identity |
| `[ ]` | `status: open` | |
| `[x]` | `status: closed` | |
| `[P]` | `labels: parallel` | Added to label list |
| `[US1]` | `labels: US1` + `priority: 1` | US2→P2, US3+→P3, no US→P2 |
| — | `issue_type: task` | Always `task` |
| — | `labels: speckit` | Always present — used for filtering |
| task ID | `metadata.task_id` | |
| user story | `metadata.user_story` | |
| parallel flag | `metadata.parallel` | |

### Bead → GitHub Issue

| Bead field | GitHub field | Notes |
|---|---|---|
| `title` | title | |
| `metadata.task_id` + `metadata.user_story` | body | Rendered as a metadata table |
| `labels[]` | labels | Labels are created in the repo if missing |
| `status == "closed"` | state = `closed` | Open otherwise |
| — | body (HTML comment) | Hidden idempotency anchor for dedup |

---

## Full workflow example

```bash
# --- Phase 1: Generate tasks ---

# In your Claude chat / IDE, run the spec-kit command to produce tasks.md:
#   /speckit.tasks
# This creates: specs/001-my-feature/tasks.md  (at your repo root)

# --- Phase 2: Import into Beads ---

cd your-project/
bd init                                  # first time only

# Preview what will be created
bdim speckit-to-beads --dry-run

# Import tasks as Beads
bdim speckit-to-beads

# Check the current sync state
bdim status

# --- Phase 3: Push to GitHub Issues ---

# Preview GitHub changes
bdim sync --repo acme/my-project --dry-run

# Push to GitHub
bdim sync --repo acme/my-project

# --- Ongoing: re-run after tasks.md changes ---

bdim speckit-to-beads               # picks up new/changed tasks
bdim sync --repo acme/my-project    # syncs changes to GitHub
```

---

## Team workflow (multi-machine)

`bdim` automatically exports `.beads/issues.jsonl` after every write command. This JSONL file is one bead per line — plain text, git-diffable, and auto-mergeable.

**Never commit `.beads/dolt/`** — it's a binary Dolt database. Only commit `issues.jsonl`.

```
.beads/
  dolt/           ← binary — in .gitignore
  *.db            ← binary — in .gitignore
  issues.jsonl    ← text, one bead per line — commit this
```

### Daily workflow

```bash
# 1. Get the latest beads from the shared repo
git pull
bd import -i .beads/issues.jsonl         # rebuild your local Dolt DB

# 2. Run /speckit.tasks if there are spec changes, then import
bdim speckit-to-beads                # auto-exports issues.jsonl
bdim sync --repo acme/my-project     # auto-exports issues.jsonl

# 3. Share the updated bead database
git add .beads/issues.jsonl
git commit -m "Update beads"
git push
```

---

## How idempotency works

Every Bead stores two hashes in its `metadata`:

- **`content_hash`** — SHA-256 of the Bead's key fields. Recomputed each run. If the task hasn't changed, the Bead is not touched.
- **`github_issue_synced_hash`** — the `content_hash` at the time of the last successful GitHub sync. If these differ, the issue is updated on the next `sync`.

Every GitHub issue body also contains a hidden HTML comment:

```html
<!-- bdim:external_id:speckit-my-project-T001 -->
```

On `sync`, this anchor is used to find the matching issue so it is updated rather than recreated — even if the `bd` database is wiped and rebuilt from scratch.

---

## Exit codes

| Code | Meaning |
|---|---|
| `0` | Success |
| `1` | Runtime error (e.g. a bead failed to sync) |
| `2` | Usage / argument error |

---

## Project structure

```
bdim                       ← the CLI script (single file, v3.0.0)
examples/
  tasks.md                     ← sample spec-kit tasks.md
```
